<div class="container">
  <header class="header">
    <h1>TaskFlow Lite</h1>
    <p class="subtitle">A lightweight Rails task manager</p>
  </header>

  <%= link_to "New Task", new_task_path, class: "btn btn-primary" %>

  <% if notice %>
    <div class="notice"><%= notice %></div>
  <% end %>
  <% if alert %>
    <div class="alert"><%= alert %></div>
  <% end %>

  <div class="priority-filter">
    <span class="filter-label">Filter by priority:</span>
    <%= link_to "All", tasks_path, class: "filter-link #{'active' if @current_priority.blank?}" %>
    <%= link_to "Low", tasks_path(priority: 'low'), class: "filter-link #{'active' if @current_priority == 'low'}" %>
    <%= link_to "Normal", tasks_path(priority: 'normal'), class: "filter-link #{'active' if @current_priority == 'normal'}" %>
    <%= link_to "High", tasks_path(priority: 'high'), class: "filter-link #{'active' if @current_priority == 'high'}" %>
  </div>

  <section class="tasks-section">
    <h2>Open Tasks (<%= @open_tasks.count %>)</h2>
    
    <% if @open_tasks.any? %>
      <div class="task-list">
        <% @open_tasks.each do |task| %>
          <div class="task-card">
            <div class="task-content">
              <div class="task-header">
                <h3 class="task-title"><%= task.title %></h3>
                <span class="priority-badge priority-<%= task.priority %>"><%= task.priority.titleize %></span>
              </div>
              <% if task.description.present? %>
                <p class="task-description"><%= simple_format(task.description) %></p>
              <% end %>
              <p class="task-meta">Created <%= time_ago_in_words(task.created_at) %> ago</p>
            </div>
            <div class="task-actions">
              <%= button_to "Complete", complete_task_path(task), method: :patch, class: "btn btn-success btn-sm" %>
              <%= link_to "Edit", edit_task_path(task), class: "btn btn-secondary btn-sm" %>
              <%= button_to "Delete", task_path(task), method: :delete, 
                  data: { turbo_confirm: "Delete this task? This cannot be undone." }, class: "btn btn-danger btn-sm" %>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="empty-state">No open tasks. Create one to get started!</p>
    <% end %>
  </section>

  <section class="tasks-section">
    <h2>Completed Tasks (<%= @completed_tasks.count %>)</h2>
    
    <% if @completed_tasks.any? %>
      <div class="task-list">
        <% @completed_tasks.each do |task| %>
          <div class="task-card task--completed">
            <div class="task-content">
              <div class="task-header">
                <h3 class="task-title"><%= task.title %></h3>
                <span class="priority-badge priority-<%= task.priority %>"><%= task.priority.titleize %></span>
              </div>
              <% if task.description.present? %>
                <p class="task-description"><%= simple_format(task.description) %></p>
              <% end %>
              <p class="task-meta">
                Completed <%= time_ago_in_words(task.completed_at) %> ago
              </p>
            </div>
            <div class="task-actions">
              <%= button_to "Reopen", reopen_task_path(task), method: :patch, class: "btn btn-secondary btn-sm" %>
              <%= button_to "Delete", task_path(task), method: :delete, 
                  data: { turbo_confirm: "Delete this task? This cannot be undone." }, class: "btn btn-danger btn-sm" %>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="empty-state">No completed tasks yet.</p>
    <% end %>
  </section>
</div>
